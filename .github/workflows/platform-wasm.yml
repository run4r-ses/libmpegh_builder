name: â€” WASM builder for libmpegh
on:
  workflow_call:

jobs:
  wasm:
    uses: ./.github/workflows/common.yml
    with:
      platform: wasm
      runs_on: ubuntu-latest
      artifact_suffix: wasm
      setup_emsdk: true
      skip_shared_build: true
      cmake_command: |
        emcmake cmake .. \
        -DCMAKE_BUILD_TYPE=Release \
        -DCMAKE_INSTALL_PREFIX=install \
        -DCMAKE_EXE_LINKER_FLAGS="\
        -s FORCE_FILESYSTEM=1 \
        -s INVOKE_RUN=0 \
        -s EXIT_RUNTIME=0 \
        -s MODULARIZE=1 \
        -s EXPORT_NAME='createMpeghDecoder' \
        -s EXPORTED_RUNTIME_METHODS=['callMain','FS'] \
        -s ALLOW_MEMORY_GROWTH=1 \
        -s TOTAL_MEMORY=256MB" -O3
      override_flags: "-DBUILD_SHARED_LIBS=OFF"
